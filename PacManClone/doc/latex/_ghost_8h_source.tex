\doxysection{C\+:/\+Users/\+Krusto/source/repos/\+Pac\+Man\+Clone/\+Pac\+Man\+Clone/\+Ghost.h}
\textbf{ Вижте документацията за този файл.}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#include "{}Point.h"{}}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}Map.h"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}Math.h"{}}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include "{}Player.h"{}}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{keyword}{namespace }PacMan \{}
\DoxyCodeLine{10     \textcolor{keyword}{class }Ghost \{}
\DoxyCodeLine{11     \textcolor{keyword}{public}:}
\DoxyCodeLine{12         Ghost() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{13 }
\DoxyCodeLine{17         \textcolor{keywordtype}{void} Move(Point dir) \{ position += dir; \}}
\DoxyCodeLine{18 }
\DoxyCodeLine{22         \textcolor{keywordtype}{float} GetTargetDistance(uint32\_t direction) \{}
\DoxyCodeLine{23             \textcolor{keywordtype}{float} x = position.x;}
\DoxyCodeLine{24             \textcolor{keywordtype}{float} y = position.y;}
\DoxyCodeLine{25 }
\DoxyCodeLine{26             \textcolor{keywordflow}{switch} (direction)}
\DoxyCodeLine{27             \{}
\DoxyCodeLine{28             \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{29             \{}
\DoxyCodeLine{30                 x += 1;}
\DoxyCodeLine{31 }
\DoxyCodeLine{32                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{33             \}}
\DoxyCodeLine{34             \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{35             \{}
\DoxyCodeLine{36                 y -\/= 1;}
\DoxyCodeLine{37 }
\DoxyCodeLine{38                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{39             \}}
\DoxyCodeLine{40             \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{41             \{}
\DoxyCodeLine{42                 x -\/= 1;}
\DoxyCodeLine{43 }
\DoxyCodeLine{44                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{45             \}}
\DoxyCodeLine{46             \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{47             \{}
\DoxyCodeLine{48                 y += 1;}
\DoxyCodeLine{49             \}}
\DoxyCodeLine{50             \}}
\DoxyCodeLine{51             \textcolor{keywordflow}{return} GetDistance(\{ x,y \}, target);}
\DoxyCodeLine{52         \}}
\DoxyCodeLine{53 }
\DoxyCodeLine{57         \textcolor{keywordtype}{bool} IsCollidingPacman(Player\& player) \{}
\DoxyCodeLine{58             \textcolor{keywordflow}{return} player.position.GetTrunc() == position;}
\DoxyCodeLine{59         \}}
\DoxyCodeLine{63         \textcolor{keywordtype}{void} UpdateTarget(uint32\_t pacmanDirection, Point ghostPosition, Point pacmanPosition,Map<21,21>\& map) \{}
\DoxyCodeLine{64                 \textcolor{keywordflow}{if} (movementMode == 0) \textcolor{comment}{// scatter mode}}
\DoxyCodeLine{65                 \{}
\DoxyCodeLine{66                     \textcolor{comment}{//отива в края на картата}}
\DoxyCodeLine{67                     \textcolor{keywordflow}{switch} (\textcolor{keywordtype}{id})}
\DoxyCodeLine{68                     \{}
\DoxyCodeLine{69                     \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{70                     \{}
\DoxyCodeLine{71                         target = \{(map.GetSizeX() -\/ 1.0f), 0.0f \};}
\DoxyCodeLine{72 }
\DoxyCodeLine{73                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{74                     \}}
\DoxyCodeLine{75                     \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{76                     \{}
\DoxyCodeLine{77                         target = \{ 0.0f, 0.0f \};}
\DoxyCodeLine{78 }
\DoxyCodeLine{79                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{80                     \}}
\DoxyCodeLine{81                     \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{82                     \{}
\DoxyCodeLine{83                         target = \{ (map.GetSizeX() -\/ 1.0f), (map.GetSizeY() -\/ 1.0f) \};}
\DoxyCodeLine{84 }
\DoxyCodeLine{85                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{86                     \}}
\DoxyCodeLine{87                     \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{88                     \{}
\DoxyCodeLine{89                         target = \{ 0.0f,(map.GetSizeY() -\/ 1.0f) \};}
\DoxyCodeLine{90                     \}}
\DoxyCodeLine{91                     \}}
\DoxyCodeLine{92                 \}}
\DoxyCodeLine{93                 \textcolor{keywordflow}{else} \textcolor{comment}{//chase mode}}
\DoxyCodeLine{94                 \{}
\DoxyCodeLine{95                     \textcolor{keywordflow}{switch} (\textcolor{keywordtype}{id})}
\DoxyCodeLine{96                     \{}
\DoxyCodeLine{97                     \textcolor{keywordflow}{case} 0: \textcolor{comment}{//червеният дух нацелва пакман}}
\DoxyCodeLine{98                     \{}
\DoxyCodeLine{99                         target = pacmanPosition;}
\DoxyCodeLine{100 }
\DoxyCodeLine{101                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{102                     \}}
\DoxyCodeLine{103                     \textcolor{keywordflow}{case} 1: \textcolor{comment}{//розовият дух нацелва 4 клетки пред пакман}}
\DoxyCodeLine{104                     \{}
\DoxyCodeLine{105                         target = pacmanPosition;}
\DoxyCodeLine{106 }
\DoxyCodeLine{107                         \textcolor{keywordflow}{switch} (pacmanDirection)}
\DoxyCodeLine{108                         \{}
\DoxyCodeLine{109                         \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{110                         \{}
\DoxyCodeLine{111                             target += \{2, 0\};}
\DoxyCodeLine{112 }
\DoxyCodeLine{113                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{114                         \}}
\DoxyCodeLine{115                         \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{116                         \{}
\DoxyCodeLine{117                             target -\/= \{0, 2\};}
\DoxyCodeLine{118 }
\DoxyCodeLine{119                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{120                         \}}
\DoxyCodeLine{121                         \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{122                         \{}
\DoxyCodeLine{123                             target -\/= \{2, 0\};}
\DoxyCodeLine{124                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{125                         \}}
\DoxyCodeLine{126                         \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{127                         \{}
\DoxyCodeLine{128                             target += \{0, 2\};}
\DoxyCodeLine{129 }
\DoxyCodeLine{130                         \}}
\DoxyCodeLine{131                         \}}
\DoxyCodeLine{132 }
\DoxyCodeLine{133                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{134                     \}}
\DoxyCodeLine{135                     \textcolor{keywordflow}{case} 2: \textcolor{comment}{// синият нацелва 2 клетки пред пакман}}
\DoxyCodeLine{136                     \{}
\DoxyCodeLine{137                         target = pacmanPosition;}
\DoxyCodeLine{138 }
\DoxyCodeLine{139                         \textcolor{keywordflow}{switch} (pacmanDirection)}
\DoxyCodeLine{140                         \{}
\DoxyCodeLine{141                         \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{142                         \{}
\DoxyCodeLine{143                             target += \{1, 0\};}
\DoxyCodeLine{144 }
\DoxyCodeLine{145                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{146                         \}}
\DoxyCodeLine{147                         \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{148                         \{}
\DoxyCodeLine{149                             target -\/= \{0, 1\};}
\DoxyCodeLine{150 }
\DoxyCodeLine{151                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{152                         \}}
\DoxyCodeLine{153                         \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{154                         \{}
\DoxyCodeLine{155                             target -\/= \{1, 0\};}
\DoxyCodeLine{156 }
\DoxyCodeLine{157                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{158                         \}}
\DoxyCodeLine{159                         \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{160                         \{}
\DoxyCodeLine{161                             target += \{0, 1\};}
\DoxyCodeLine{162                         \}}
\DoxyCodeLine{163                         \}}
\DoxyCodeLine{164 }
\DoxyCodeLine{165                         target += \{target.x -\/ ghostPosition.x, }
\DoxyCodeLine{166                                      target.y -\/ ghostPosition.y\};}
\DoxyCodeLine{167 }
\DoxyCodeLine{168                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{169                     \}}
\DoxyCodeLine{170                     \textcolor{keywordflow}{case} 3: \textcolor{comment}{// оранжевият дух преследва пакман и след това отива в scatter режим}}
\DoxyCodeLine{171                     \{}
\DoxyCodeLine{172                         }
\DoxyCodeLine{173                         \textcolor{keywordflow}{if} ( GetDistance(pacmanPosition,position) >= 4)}
\DoxyCodeLine{174                         \{}
\DoxyCodeLine{175                             target = pacmanPosition;}
\DoxyCodeLine{176                         \}}
\DoxyCodeLine{177                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{178                         \{}
\DoxyCodeLine{179                             target = \{ 0.0f, (map.GetSizeY() -\/ 1.0f) \};}
\DoxyCodeLine{180                         \}}
\DoxyCodeLine{181                     \}}
\DoxyCodeLine{182                     \}}
\DoxyCodeLine{183                 \}}
\DoxyCodeLine{184         \}}
\DoxyCodeLine{188         \textcolor{keywordtype}{void} Update(Map<21, 21>\& map, Player\& player,Ghost\& ghost) \{}
\DoxyCodeLine{189             \textcolor{keywordtype}{bool} move = 0;}
\DoxyCodeLine{190 }
\DoxyCodeLine{191             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} available\_ways = 0;}
\DoxyCodeLine{192             \textcolor{keywordtype}{float} speed = 1;}
\DoxyCodeLine{193 }
\DoxyCodeLine{194             \textcolor{keywordtype}{bool} walls[4]\{\};}
\DoxyCodeLine{195 }
\DoxyCodeLine{196             UpdateTarget(player.direction,ghost.position, player.position,map);}
\DoxyCodeLine{197 }
\DoxyCodeLine{198             walls[0] = map.Get(position + Point\{ speed,0 \}) == \textcolor{charliteral}{'\#'};}
\DoxyCodeLine{199             walls[1] = map.Get(position + Point\{ 0,-\/speed \}) == \textcolor{charliteral}{'\#'};}
\DoxyCodeLine{200             walls[2] = map.Get(position + Point\{ -\/speed,0 \}) == \textcolor{charliteral}{'\#'};}
\DoxyCodeLine{201             walls[3] = map.Get(position + Point\{ 0,speed \}) == \textcolor{charliteral}{'\#'};}
\DoxyCodeLine{202 }
\DoxyCodeLine{203             \textcolor{keywordflow}{if} (frightenedMode != 1)}
\DoxyCodeLine{204             \{}
\DoxyCodeLine{205                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} optimal\_direction = 4;}
\DoxyCodeLine{206 }
\DoxyCodeLine{207                 \textcolor{comment}{// духчето може да мърда}}
\DoxyCodeLine{208                 move = 1;}
\DoxyCodeLine{209 }
\DoxyCodeLine{210                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} a = 0; a < 4; a++)}
\DoxyCodeLine{211                 \{}
\DoxyCodeLine{212                     \textcolor{comment}{//духчетата не могат да се обърнат, стига да не е нужно}}
\DoxyCodeLine{213                     \textcolor{keywordflow}{if} (a == (2 + direction) \% 4)}
\DoxyCodeLine{214                     \{}
\DoxyCodeLine{215                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{216                     \}}
\DoxyCodeLine{217                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (walls[a] == \textcolor{keyword}{false})}
\DoxyCodeLine{218                     \{}
\DoxyCodeLine{219                         \textcolor{keywordflow}{if} (optimal\_direction == 4)}
\DoxyCodeLine{220                         \{}
\DoxyCodeLine{221                             optimal\_direction = a;}
\DoxyCodeLine{222                         \}}
\DoxyCodeLine{223 }
\DoxyCodeLine{224                         available\_ways++;}
\DoxyCodeLine{225 }
\DoxyCodeLine{226                         \textcolor{keywordflow}{if} (GetTargetDistance(a) < GetTargetDistance(optimal\_direction))}
\DoxyCodeLine{227                         \{}
\DoxyCodeLine{228                             \textcolor{comment}{// оптималната посока за да стигне целта}}
\DoxyCodeLine{229                             optimal\_direction = a;}
\DoxyCodeLine{230                         \}}
\DoxyCodeLine{231                     \}}
\DoxyCodeLine{232                 \}}
\DoxyCodeLine{233 }
\DoxyCodeLine{234                 \textcolor{keywordflow}{if} (available\_ways > 1)}
\DoxyCodeLine{235                 \{}
\DoxyCodeLine{236                     \textcolor{comment}{// когато стигне кръстопът избира най добрата посока}}
\DoxyCodeLine{237                     direction = optimal\_direction;}
\DoxyCodeLine{238                 \}}
\DoxyCodeLine{239                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{240                 \{}
\DoxyCodeLine{241                     \textcolor{keywordflow}{if} (optimal\_direction == 4)}
\DoxyCodeLine{242                     \{}
\DoxyCodeLine{243                         \textcolor{comment}{// обръща се духчето на обратно защото трябва}}
\DoxyCodeLine{244                         direction = (2 + direction) \% 4;}
\DoxyCodeLine{245                     \}}
\DoxyCodeLine{246                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{247                     \{}
\DoxyCodeLine{248                         direction = optimal\_direction;}
\DoxyCodeLine{249                     \}}
\DoxyCodeLine{250                 \}}
\DoxyCodeLine{251             \}}
\DoxyCodeLine{252             \textcolor{keywordflow}{else}}
\DoxyCodeLine{253             \{}
\DoxyCodeLine{254                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} random\_direction = rand() \% 4;}
\DoxyCodeLine{255 }
\DoxyCodeLine{256                 \textcolor{keywordflow}{if} (frightenedSpeedTimer == 0)}
\DoxyCodeLine{257                 \{}
\DoxyCodeLine{258                     }
\DoxyCodeLine{259                     move = 1;}
\DoxyCodeLine{260 }
\DoxyCodeLine{261                     frightenedSpeedTimer = 30;}
\DoxyCodeLine{262 }
\DoxyCodeLine{263                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} a = 0; a < 4; a++)}
\DoxyCodeLine{264                     \{}
\DoxyCodeLine{265                         \textcolor{comment}{// не може да се обръщат дори и да се страхуват}}
\DoxyCodeLine{266                         \textcolor{keywordflow}{if} (a == (2 + direction) \% 4)}
\DoxyCodeLine{267                         \{}
\DoxyCodeLine{268                             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{269                         \}}
\DoxyCodeLine{270                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (walls[a] == 0)}
\DoxyCodeLine{271                         \{}
\DoxyCodeLine{272                             available\_ways++;}
\DoxyCodeLine{273                         \}}
\DoxyCodeLine{274                     \}}
\DoxyCodeLine{275 }
\DoxyCodeLine{276                     \textcolor{keywordflow}{if} (available\_ways > 0)}
\DoxyCodeLine{277                     \{}
\DoxyCodeLine{278                         \textcolor{keywordflow}{while} (walls[random\_direction] == 1 || random\_direction == (2 + direction) \% 4)}
\DoxyCodeLine{279                         \{}
\DoxyCodeLine{280                             \textcolor{comment}{// взимаме произволна посока докато не може да я използваме}}
\DoxyCodeLine{281                             random\_direction = rand() \% 4;}
\DoxyCodeLine{282                         \}}
\DoxyCodeLine{283 }
\DoxyCodeLine{284                         direction = random\_direction;}
\DoxyCodeLine{285                     \}}
\DoxyCodeLine{286                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{287                     \{}
\DoxyCodeLine{288                         \textcolor{comment}{// ако няма друг път се обръща наобратно}}
\DoxyCodeLine{289                         direction = (2 + direction) \% 4;}
\DoxyCodeLine{290                     \}}
\DoxyCodeLine{291                 \}}
\DoxyCodeLine{292                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{293                 \{}
\DoxyCodeLine{294                     frightenedSpeedTimer-\/-\/;}
\DoxyCodeLine{295                 \}}
\DoxyCodeLine{296             \}}
\DoxyCodeLine{297             \textcolor{comment}{// ако може да се мръдне го местим}}
\DoxyCodeLine{298             \textcolor{keywordflow}{if} (move)}
\DoxyCodeLine{299             \{}
\DoxyCodeLine{300                 \textcolor{keywordflow}{switch} (direction)}
\DoxyCodeLine{301                 \{}
\DoxyCodeLine{302                 \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{303                 \{}
\DoxyCodeLine{304                     position.x += speed;}
\DoxyCodeLine{305 }
\DoxyCodeLine{306                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{307                 \}}
\DoxyCodeLine{308                 \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{309                 \{}
\DoxyCodeLine{310                     position.y -\/= speed;}
\DoxyCodeLine{311 }
\DoxyCodeLine{312                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{313                 \}}
\DoxyCodeLine{314                 \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{315                 \{}
\DoxyCodeLine{316                     position.x -\/= speed;}
\DoxyCodeLine{317 }
\DoxyCodeLine{318                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{319                 \}}
\DoxyCodeLine{320                 \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{321                 \{}
\DoxyCodeLine{322                     position.y += speed;}
\DoxyCodeLine{323                 \}}
\DoxyCodeLine{324                 \}}
\DoxyCodeLine{325 }
\DoxyCodeLine{326                 \textcolor{comment}{// когато мине през портала го пращаме от другата страна}}
\DoxyCodeLine{327                 \textcolor{keywordflow}{if} (position.x <= -\/1)}
\DoxyCodeLine{328                 \{}
\DoxyCodeLine{329                     position.x = map.GetSizeX() -\/ speed;}
\DoxyCodeLine{330                 \}}
\DoxyCodeLine{331                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (position.x >= map.GetSizeX())}
\DoxyCodeLine{332                 \{}
\DoxyCodeLine{333                     position.x = speed;}
\DoxyCodeLine{334                 \}}
\DoxyCodeLine{335             \}}
\DoxyCodeLine{336 }
\DoxyCodeLine{337             \textcolor{keywordflow}{if} (position.GetTrunc() == player.position.GetTrunc())}
\DoxyCodeLine{338             \{}
\DoxyCodeLine{339                 \textcolor{keywordflow}{if} (frightenedMode == 0) \textcolor{comment}{// когато не е уплашен и докосне пакман, играта приключва}}
\DoxyCodeLine{340                 \{}
\DoxyCodeLine{341                     player.isDead = 1;}
\DoxyCodeLine{342                 \}}
\DoxyCodeLine{343                 \textcolor{keywordflow}{else} \textcolor{comment}{//иначе бяга към клетката}}
\DoxyCodeLine{344                 \{}
\DoxyCodeLine{345                     frightenedMode = 2;}
\DoxyCodeLine{346 }
\DoxyCodeLine{347                     target = home;}
\DoxyCodeLine{348                 \}}
\DoxyCodeLine{349             \}}
\DoxyCodeLine{350         \}}
\DoxyCodeLine{354         uint32\_t \textcolor{keywordtype}{id}\{\};}
\DoxyCodeLine{358         uint32\_t frightenedSpeedTimer\{\};}
\DoxyCodeLine{362         \textcolor{keywordtype}{bool} frightenedMode\{\};}
\DoxyCodeLine{366         uint32\_t movementMode\{0\};}
\DoxyCodeLine{370         Point position\{\};}
\DoxyCodeLine{374         Point home\{10,10\};}
\DoxyCodeLine{378         uint32\_t direction\{\};}
\DoxyCodeLine{382         Point target\{\};}
\DoxyCodeLine{383     \};}
\DoxyCodeLine{384 \}}

\end{DoxyCode}
